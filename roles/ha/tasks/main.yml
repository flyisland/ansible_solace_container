- debug:
    msg: "Creating **{{ ha_role }}** container of the HA group"

- name: remove the existing "solace" container
  shell: docker rm -f solace
  ignore_errors: yes

- name: Get vmr version
  shell: docker images | grep solace | awk '{printf "%s:%s", $1, $2}'
  register: vmr_version

- name: Set Container Create Options
  template:
    src: ha-create.sh.j2
    dest: /tmp/ha-create.sh
    force: yes
    owner: root
    group: root
    mode: u+x

- name: Create the Container
  shell: /tmp/ha-create.sh && docker start solace

- name: Prepare the assert-leader.sh file
  template:
    src: assert-leader.sh
    dest: /tmp/assert-leader.sh
    force: yes
    mode: u+x
  when: ha_role == "primary"

- name: Asserting Event Brokers Router and VPN Configurations
  shell: /tmp/assert-leader.sh
  when: ha_role == "primary"
  register: asserting_output

- name: Print the asserting result
  ansible.builtin.debug:
    var: asserting_output.stdout_lines
  when: ha_role == "primary"
